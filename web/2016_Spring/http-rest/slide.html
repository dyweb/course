<html>
<head>
  <title>2016 Spring Web | HTTP &amp; RESTful API by ComMouse</title>
  <meta charset="UTF-8">
  <meta name="description" content="Dongyue Web Studio 2016 Spring Web Instant PHP by ComMouse">
  <meta name="author" content="arrowrowe">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <meta name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/css/reveal.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/css/theme/black.min.css" id="theme">

  <!-- Code syntax highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/lib/css/zenburn.min.css">

  <!-- Printing and PDF exports -->
  <!-- FIXME: this does not work properly -->
  <script>
    var pdfCss = 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/css/print/pdf.min.css';
    var paperCss = 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/css/print/paper.min.css';
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match(/print-pdf/gi) ? pdfCss : paperCss;
    document.getElementsByTagName('head')[0].appendChild(link);
  </script>

  <!--[if lt IE 9]>
    <script>alert('Please use Chrome');</script>
  <![endif]-->

  <style>
    blockquote {
      text-align: left;
    }
    blockquote > footer {
      text-align: right;
    }
    blockquote > footer::before {
      content: '-- ';
    }
    img.no-border {
      border: none !important;
      background: none !important;
    }
    table, table tr, table th {
      color: #fff;
    }
    .reveal code,
    .reveal pre {
      font-family: 'Source Code Pro', Consolas, 'Curior New', 'Arial', monospace;
    }
    .reveal .form-control {
      font-size: 25px;
      height: 1.8em;
    }
  </style>

</head>
<body>
  <div class="reveal">
    <div class="slides">
      <section data-background="images/bg_kagari.png" style="background-color:rgba(0,0,0,0.4)">
        <h2>HTTP &amp; RESTful API</h2>
        <h4>2016 Spring Dongyue Web Studio</h4>
        <p>
          <small>by <a href="https://github.com/ComMouse" target="_blank">ComMouse</a></small>
        </p>
        <p><small>(background image from Rewrite)</small></p>
      </section>
      <section>
        <h3>Contents</h3>
        <ul>
          <li><a href="#/quick">Quick View</a></li>
          <li><a href="#/work">Request/Response</a></li>
          <li><a href="#/http">HTTP Structure</a></li>
          <li><a href="#/rest">RESTful API</a></li>
          <li><a href="#/design">RESTful API Design</a></li>
          <li><a href="#/assignment">Assignment</a></li>
        </ul>
      </section>
      <section id="quick">
        <section>
          <h2>Quick View</h2>
        </section>
        <section data-markdown>
          <script type="text/template">
          ## Question

          - What happens when you type google.com into your browser's address box and press enter?

          https://github.com/alex/what-happens-when
          </script>
        </section>
      </section>
      <section id="work">
        <section>
          <h2>Request/Response</h2>
          <p>How can we get access to pages?</p>
          <img src="images/part1/http1-request-response.png">
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Request/Response

            1. Type an address and enter
            2. The browser sends a request to a server
            3. The server gives back a response
            4. The browser parse the response and render the page
          </script>
        </section>
        <section>
          <h2>How does it work?</h2>
          <br>
          <h1 class="fragment">HTTP</h1>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Where is HTTP?

            - Application Layer

            ![OSI model](images/part1/osi-model.jpg)

            - Uses 80 port by default
            - Stateless protocol
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Where is the server?

            - Server IP address
            - Returned from DNS server

            ![DNS](images/part1/how-dns-works.jpg)

            - *System `hosts` file*
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Where is the server? (Cont.)

            ![DNS](images/part1/dns-detail.png)

            - *DNS Pollution*
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## How to observe HTTP?

            - [Chrome DevTools](https://developer.chrome.com/devtools)
            - [Fiddler](http://www.telerik.com/fiddler)
            - [Wireshark](https://www.wireshark.org/)
          </script>
        </section>
      </section>
      <section id="http">
        <section data-markdown>
          <script type="text/template">
            ## HTTP Structure

            - HTTP Version
            - URI
            - Verb
            - Status Code
            - Message Format
            - Identification
            - Authentication
            - *Cache
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## HTTP Version

            - HTTP/1.0
              - Legacy Version
            - HTTP/1.1
              - Persistent Connection, Host, Cache, Chunked, ...
            - [HTTP/2](https://http2.github.io/)
              - Binary, Multiplexed, Server Push, SPDY, ...
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## URI

            - URI (Uniform Resource Indentifier)
              - URL (Uniform Resource __Locator__)
                - `http://tongqu.me/act/type?page=1`
                - Locator for resources
              - URN (Uniform Resource __Name__)
                - `urn:isbn:0451450523`
              - ...
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## URL

            ```
            scheme:[//[user:password@]host[:port]][/]path[?query][#fragment]
            ```

            - scheme: http, ftp, ...
            - host: `tongqu.me`, `localhost`, `59.78.12.34`
            - port: 80, 21, ...
            - path: `index.php`, `act/1234`
            - query: `?a=1&b=2`
            - fragment: `#title-1`
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Verb

            - GET, POST
            - PUT, PATCH, DELETE
            - HEAD, OPTIONS
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Verb (Cont.)

            - POST Content Type
              - application/x-www-form-urlencoded
              - multipart/form-data
              - application/json
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Status Code

            - 1xx
              - 100 Continue
            - 2xx
              - 200 OK
              - 201 Created
              - 202 Accepted
              - 204 No Content
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Status Code (Cont.)

            - 3xx
              - 301 Moved Permanently
              - 302 Moved Temporarily (header Location)
              - 304 Not Modified
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Status Code (Cont.)

            - 4xx
              - 400 Bad Request
              - 401 Unauthorized
              - 403 Forbidden
              - 404 Not Found
              - 405 Method Not Allowed
              - 409 Conflict
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Status Code (Cont.)

            - 5xx
              - 500 Internal Server Error
              - 501 Not Implemented
              - 502 Bad Gateway
              - 503 Service Unavailable
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Message Format
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Request

            ```
GET /index.php HTTP/1.1
Host: tongqu.me
Connection: keep-alive
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.94 Safari/537.36
DNT: 1
Accept-Encoding: gzip, deflate, sdch
Accept-Language: zh-CN,zh;q=0.8
Cookie: tq_ci_session_id=01564fb651093b7fe04916c72f4628c6
            ```
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Response

            ```
HTTP/1.1 200 OK
Server: nginx
Date: Wed, 04 May 2016 12:22:35 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive
Content-Encoding: gzip

4269
Here is the content (compressed with gzip)...
            ```
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Headers

            - General Headers
                - Connection
                - Date
                - Pragma
                - Trailer
                - Transfer-Encoding
                - Upgrade
                - Via
                - Warning
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Headers

            - Entity Headers
                - Allow     
                - Content-Encoding
                - Content-Language
                - Content-Length
                - Content-Location
                - Content-MD5
                - Content-Range
                - *Content-Type*
                - Expires
                - Last-Modified
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Headers

            - Request Headers
                - Accept, Accept-Charset, Accept-Encoding, Accept-Language
                - Authorization, Proxy-Authorization
                - Expect
                - *Host*
                - If-Match, If-Modified-Since, If-None-Match, If-Range, If-Unmodified-Since
                - Max-Forwards
                - Range
                - *Referer*
                - *User-Agent*
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Headers

            - Response Headers
                - Accept-Ranges
                - Age
                - ETag
                - *Location*
                - Proxy-Authenticate
                - Retry-After
                - Server
                - Vary
                - WWW-Authenticate
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Message Body

            - Request Body
                - application/x-www-form-urlencoded
                - multipart/form-data
                - application/json
                - text/xml
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Message Body

            - Response Body
                - text/html
                - application/json
                - text/xml
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Identification

            - Headers
                - Host, Referer, User-Agent
            - Cookie
            - Session
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Authentication

            - Basic Auth
            - Secure HTTP (SSL)
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Caching

            - Client-side Cache
            - Server-side Cache
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Client-side Cache

            - Cache-Control
                - no-cache
                - max-age
            - Expires (Old)
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Server-side Cache

            - Last-Modified
            - ETag
            - Application cache
          </script>
        </section>
      </section>
      <section id="rest">
        <section>
          <h2>RESTful API</h2>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## API?

            - __A__pplication __P__rogramming __I__nterfacce
            - Refers to __HTTP API__ in our topic
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Why API?

            - To separate front-end & back-end
            - Open to other developers
            - Friendly to Mobile & Desktop Platforms
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Why REST?

            ### REST?
            - __REST__: __R__epresentational __S__tate __T__ransfer
            - __RESTful API__: API following REST style

            ### Why?
            - Resource-based style
            - Clear & easy to understand & extend
            - Full use of HTTP protocol
            - More & more developers are using!
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Why REST? (Cont.)

            ### RESTful API
            ```
            GET /students/336/semaster/1/scores?page=1
            ```
            ```
            DELETE /students/336/semaster/1/scores/5
            ```

            ### Compared with...
            ```
            GET /mod_student/student.php?action=get_student_socre&id=336&se_id=1&p=1
            ```
            ```
            POST /student_score/delete_student_score
            (The rest of the arguments are given in request body)
            ```
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## REST

            - Resources: Entities (URI)
            - Representation: JSON, XML, ...
            - State Transfer: Interact with resources
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## REST (Cont.)

            - State Transfer: Interact with resources
                - __POST__ *__C__reate a resource*
                - __GET__ *__R__etrieve a resource or a resource list*
                - __PUT__ *__U__pdate a resource*
                - __DELETE__ *__D__elete a resource*

            Also called __CRUD__
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## How to use RESTful API?

            - Follow the API doc
            - Tool
                - cURL
                - [Postman](http://www.getpostman.com/)
          </script>
        </section>
      </section>
      <section id="design">
        <section>
          <h2>RESTful API Design</h2>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## URL

            <img src="images/part4/url.png" style="background-color: white;">

            *http://code.tutsplus.com/tutorials/http-the-protocol-every-web-developer-must-know-part-1--net-31177
*
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Versioning

            ### Strict Version
```
Accept: application/vnd.github.v3+json
```
            ### Ugly Version
```
https://api.example.com/v1/users/1
http://www.example.com/api/v1/users/1
```
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Endpoints

            - Uses plural nouns & no verbs
            - Presents a resource or a collection

```
// Good:
https://api.example.com/v1/zoos
https://api.example.com/v1/animals
https://api.example.com/v1/animal_types
https://api.example.com/v1/employees

// Not Good:
https://api.example.com/v1/user         // Using a singluar word
https://api.example.com/v1/register     // Using a verb
```

          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Verbs

            - `GET`:     *Retrieve*
            - `POST`:    *Create*
            - `PUT`:     *Update*
            - `DELETE`:  *Delete*
            
            *(Not frequently used)*
            - `PATCH`:       *Partially update*
            - `OPTIONS`:     *Get the availables verbs for the resource*
            - `HEAD`:        *Retrieve in header only*
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Verbs (Cont.)

            - Complete API of zoos

```c
GET /zoos        // List all Zoos (ID and Name, not too much detail)
POST /zoos       // Create a new Zoo
GET /zoos/:id    // Retrieve an entire Zoo object
PUT /zoos/:id    // Update a Zoo (entire object)
PATCH /zoos/:id  // Update a Zoo (partial object)
DELETE /zoos/:id // Delete a Zoo
```
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Verbs (Cont.)

            ### Challenge

            How about designing a verifying operation?

```c
PUT /users/:id/verification
```
```c
POST /users/:id/verify
```
```c
PATCH /users/:id // (with form data: "verified: true")
```
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Verbs (Cont.)

            ### Also...

```c
GET /searching_results/:keyword
```
```c
GET /search?keyword=abc
```
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Verbs (Cont.)

            ### Another Challenge
            Most servers disallows verbs except GET and POST out of security reasons
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Verbs (Cont.)

            ### Solution
            
            <p>1. Use POST to "create" a verb</p>

```c
POST /users/:id  // (with form data: "_method: DELETE")
POST /users/:id  // (with form data: "_method: PATCH")
```

            *Many frameworks support this trick.*
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Verbs (Cont.)

            ### Solution
            
            <p>2. Add a customized header to a POST request</p>

```c
X-HTTP-Method-Override: PUT
```

            *Many frameworks support this trick, too.*
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Filtering

            Which is better?

```c
GET /users/page/:page_id
GET /users?page=:page_id
```

```c
POST /users/:id/verify  // (with form data: "role_id: :admin_role")
POST /users/:id/verify?role_id=:admin_role
```

```c
GET /employees?company_id=5&gender=male&page=1&per_page=10
GET /companies/5/genders/male/employees?page=1&per_page=10
```
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Filtering (Cont.)

            ### Query String

            - Frequently used options

```c
?limit=10       // Number per page (for pagination)
?offset=10      // Records skipped (for pagination)
?page=1         // Page number (for pagination)
?per_page=10    // Records per page (for pagination)
?animal_type_id=1       // Filtering (WHERE animal_type_id = 1)
?sortby=name&order=asc  // Sorting rules (ORDER BY name ASC)

```
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Status Code

            Use status code to return results

            ![Status Code](images/part4/status-code.png)
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Response Body

            - `GET`:     *Object or an array of objects*
            - `POST`:    *Created object*
            - `PUT`:     *Updated object*
            - `PATCH`:   *Updated object*
            - `DELET`:   *Empty*

            Content Type: JSON/XML/...
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Authentication

            - HTTPS: Security
            - JSON Web Token
            - OAuth2

            *Attention: Avoid using cookie*
            - Only browsers have cookies
            - API shoule be designed to be stateless

          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Maintainence

            - Don't forget to write api docs!
            - Tests
                - Unit Test
                - Functional Test
                - Acceptance Test
                - continuous intergations (CI)
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Framework Support

            - Most frameworks support routes with verbs
                - Ruby: Ruby on Rails
                - PHP: Laravel, Slim, CodeIgniter
                - Python: Django
                - Node.js: Express.js
            - And some support REST style with just one controller
          </script>
        </section>
      </section>
      <section id="assignment">
        <section>
          <h2>Assignment</h2>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Assignment

            1. Learn to use Chrom DevTool & Fiddler to observe HTTP connections.
            2. Select a PHP microframework (Slim/Flight/...) and implement a simple REST service of a to-do list.
            ```c
            GET /api/v1/tasks        // Get all tasks
            GET /api/v1/tasks/:id    // Get a task by id
            POST /api/v1/tasks       // Create a new task
            PUT /api/v1/tasks/:id    // Update a given task
            DELETE /api/v1/tasks/:id // Delete a task
            ```
            3. (Optional) Write a crawler for [Tongqu Act API](http://tongqu.me/api/act/type). Here is the [doc](https://github.com/dyweb/android-stuff/blob/master/interview/old/api.md) of this API.
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## How to hand in?

            - Email: web@dongyue.io
            - GitHub / GitLab Tq:
              1. Crete a new repository and make it public
              2. Open an issue [here](https://github.com/dyweb/course/issues) and tell us your repository link
            - QQ, Wechat is also OK!

            ## Due?
            - Deadline: May 16th
            - Answers available next week
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Reading Materials (HTTP)

            ### Tutorials
            - HTTP: The Protocol Every Web Developer Must Know
              - [Part I](http://code.tutsplus.com/tutorials/http-the-protocol-every-web-developer-must-know-part-1--net-31177)
              - [Part II](http://code.tutsplus.com/tutorials/http-the-protocol-every-web-developer-must-know-part-2--net-31155)
            - [深入理解 HTTP 协议](http://www.360doc.com/content/10/0930/17/3668821_57590979.shtml)
            - [HTTP 教程](http://www.tutorialspoint.com/http/)

            ### Tools
            - [Fiddler](http://www.telerik.com/fiddler)
            - [Chrome DevTools OverView](https://developer.chrome.com/devtools)
            - [Wireshark](https://www.wireshark.org/)

          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Reading Materials (RESTful API)

            ### Tutorials
            - [RESTful API 设计指南](http://www.ruanyifeng.com/blog/2014/05/restful_api.html)
            - [理解 RESTful 架构](http://www.ruanyifeng.com/blog/2011/09/restful.html)
            - [REST API Tutorial](http://www.restapitutorial.com/)

            ### Frameworks
            - [Slim](http://www.slimframework.com/)
            - [Flight](http://flightphp.com/)

            ### Tools
            - [Postman](http://www.getpostman.com/)
            - [Scrapy](http://scrapy.org/)
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Q & A
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ## Thank you for your listening!
          </script>
        </section>
      </section>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/lib/js/head.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/js/reveal.js"></script>

  <script>
    // Full list of configuration options available at:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
      controls: true,
      progress: true,
      history: true,
      center: true,

      transition: 'slide', // none/fade/slide/convex/concave/zoom

      // Optional reveal.js plugins
      dependencies: [
        {
          src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/lib/js/classList.js',
          condition: function () {
            return !document.body.classList;
          }
        },
        {
          src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/plugin/markdown/marked.js',
          condition: function () {
            return !!document.querySelector('[data-markdown]');
          }
        },
        {
          src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/plugin/markdown/markdown.js',
          condition: function () {
            return !!document.querySelector('[data-markdown]');
          }
        },
        {
          src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/plugin/highlight/highlight.js',
          async: true,
          callback: function () {
            hljs.initHighlightingOnLoad();
          }
        },
        {src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/plugin/zoom-js/zoom.js', async: true},
        {src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/plugin/notes/notes.js', async: true}
      ]
    });
  </script>
</body>
</html>
